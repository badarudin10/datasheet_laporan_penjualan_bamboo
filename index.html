<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BambooArt Pro Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #0d1117; color: #e6edf3; }
        .glass { background: rgba(22, 27, 34, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(48, 54, 61, 1); border-radius: 1.5rem; }
        .card-green { background: linear-gradient(135deg, #238636 0%, #2ea043 100%); }
        .card-amber { background: linear-gradient(135deg, #9e6a03 0%, #d29922 100%); }
        .modal { display: none; position: fixed; inset: 0; background: rgba(1, 4, 9, 0.95); z-index: 1000; padding: 20px; overflow-y: auto; }
        .status-badge { padding: 4px 12px; border-radius: 999px; font-size: 10px; font-weight: 800; text-transform: uppercase; }
        @media print { .no-print { display: none !important; } .modal { display: block !important; position: static; background: white; color: black; } }
    </style>
</head>
<body class="p-4 md:p-8 pb-32">

    <div class="max-w-6xl mx-auto">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4 no-print">
            <div class="flex items-center gap-4">
                <div class="bg-green-500 text-black p-3 rounded-2xl font-black text-xl shadow-lg shadow-green-500/20">BA</div>
                <div>
                    <h1 class="text-2xl font-black tracking-tight text-white uppercase italic">BambooArt <span class="text-green-500">Intelligence</span></h1>
                    <p class="text-[10px] font-bold text-gray-500 uppercase tracking-widest">Sistem Laporan Keuangan Terpadu</p>
                </div>
            </div>
            <div class="flex gap-2">
                <button onclick="location.reload()" class="glass px-6 py-3 rounded-xl text-xs font-bold hover:bg-white/5 transition border border-white/10">üîÑ REFRESH DATA</button>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
            <div class="card-green p-6 rounded-3xl shadow-xl col-span-1 md:col-span-2">
                <p class="text-[10px] font-black uppercase opacity-80 mb-1">Total Omzet Keseluruhan</p>
                <h2 id="mainOmzet" class="text-4xl font-black italic tracking-tighter">Rp 0</h2>
                <p class="text-[9px] mt-4 font-bold bg-black/20 inline-block px-2 py-1 rounded">Update Real-time dari Baris Omzet</p>
            </div>
            <div class="card-amber p-6 rounded-3xl shadow-xl cursor-pointer hover:scale-[1.02] transition" onclick="openModal('modFinance')">
                <p class="text-[10px] font-black uppercase opacity-80 mb-1">Modal Mengendap</p>
                <h2 id="mainModalMati" class="text-3xl font-black italic tracking-tighter text-white">Rp 0</h2>
                <p class="text-[9px] mt-4 font-bold bg-black/20 inline-block px-2 py-1 rounded">Stok Macet x Modal Unit</p>
            </div>
            <div class="glass p-6 rounded-3xl flex flex-col justify-center border-l-8 border-sky-500 shadow-xl">
                <p class="text-[10px] font-bold uppercase text-sky-500 mb-1">Estimasi Untung Bersih</p>
                <h2 id="mainProfit" class="text-3xl font-black italic tracking-tighter text-white">Rp 0</h2>
            </div>
        </div>

        <div class="glass p-6 mb-8">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xs font-black uppercase tracking-[0.2em] italic text-gray-400">Trend Penjualan Bulanan (Jan-Des)</h3>
            </div>
            <div class="h-64"><canvas id="chartOmzet"></canvas></div>
        </div>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 no-print">
            <button onclick="openModal('modFinance')" class="glass p-6 rounded-3xl hover:border-amber-500 transition group text-center">
                <div class="text-2xl mb-2 group-hover:scale-110 transition">üí∞</div>
                <p class="text-[10px] font-black uppercase tracking-widest">Rincian Modal</p>
            </button>
            <button onclick="openModal('modMarket')" class="glass p-6 rounded-3xl hover:border-sky-500 transition group text-center">
                <div class="text-2xl mb-2 group-hover:scale-110 transition">üìä</div>
                <p class="text-[10px] font-black uppercase tracking-widest">Analisa Pasar</p>
            </button>
            <button onclick="openModal('modSales')" class="glass p-6 rounded-3xl hover:border-purple-500 transition group text-center">
                <div class="text-2xl mb-2 group-hover:scale-110 transition">üìÖ</div>
                <p class="text-[10px] font-black uppercase tracking-widest">Omzet Bulanan</p>
            </button>
            <button onclick="window.print()" class="glass p-6 rounded-3xl hover:border-white transition group text-center">
                <div class="text-2xl mb-2 group-hover:scale-110 transition">üìÑ</div>
                <p class="text-[10px] font-black uppercase tracking-widest">Cetak Laporan</p>
            </button>
        </div>
    </div>

    <div id="modFinance" class="modal">
        <div class="max-w-5xl mx-auto py-10">
            <div class="flex justify-between items-center mb-8 border-b border-gray-800 pb-4">
                <h2 class="text-3xl font-black text-amber-500 italic uppercase">Laporan Rincian Asset</h2>
                <button onclick="closeModal('modFinance')" class="text-4xl hover:text-red-500">&times;</button>
            </div>
            <div class="glass overflow-hidden shadow-2xl">
                <table class="w-full text-left text-xs">
                    <thead class="bg-white/5 uppercase font-black text-gray-400 border-b border-gray-800">
                        <tr>
                            <th class="p-5">Nama Produk</th>
                            <th class="p-5 text-center">Modal Satuan</th>
                            <th class="p-5 text-center">Sisa Stok</th>
                            <th class="p-5 text-right">Modal Mengendap</th>
                            <th class="p-5 text-center">Saran Strategi</th>
                        </tr>
                    </thead>
                    <tbody id="tableFinance" class="divide-y divide-gray-800"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="modMarket" class="modal">
        <div class="max-w-5xl mx-auto py-10">
            <div class="flex justify-between items-center mb-8 border-b border-gray-800 pb-4">
                <h2 class="text-3xl font-black text-sky-500 italic uppercase">Analisa Pergerakan Pasar</h2>
                <button onclick="closeModal('modMarket')" class="text-4xl hover:text-red-500">&times;</button>
            </div>
            <div id="marketContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </div>
    </div>

    <div id="modSales" class="modal">
        <div class="max-w-2xl mx-auto py-10 text-center">
            <div class="flex justify-between items-center mb-10">
                <h2 class="text-3xl font-black text-purple-500 italic uppercase">Laporan Omzet Per Bulan</h2>
                <button onclick="closeModal('modSales')" class="text-4xl hover:text-red-500">&times;</button>
            </div>
            <div id="salesContainer" class="grid grid-cols-2 md:grid-cols-3 gap-4"></div>
        </div>
    </div>

    <script>
        const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQXdrHU-IFBl2jmf3Unzy8Jb2Uh7VfK5uvX0OeO7Ivlc88QC6ahXNFJf1VlGWlTb7Mfp4xzeSY6BsXx/pub?output=csv";

        function openModal(id) { document.getElementById(id).style.display = 'block'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }

        function syncData() {
            Papa.parse(CSV_URL, {
                download: true,
                complete: function(results) {
                    const data = results.data;
                    const fTable = document.getElementById('tableFinance');
                    const mContainer = document.getElementById('marketContainer');
                    const sContainer = document.getElementById('salesContainer');

                    let totalOmzetAll = 0;
                    let totalModalDead = 0;
                    let totalCogsSold = 0;

                    fTable.innerHTML = ''; mContainer.innerHTML = ''; sContainer.innerHTML = '';

                    // 1. CARI BARIS OMZET (Ambil data Grafik dan Total)
                    const omzetRow = data.find(r => r[1] && r[1].trim().toUpperCase() === "OMZET");
                    if (omzetRow) {
                        totalOmzetAll = parseInt((omzetRow[15] || "0").replace(/[^\d]/g, '')) || 0;
                        document.getElementById('mainOmzet').innerText = "Rp " + totalOmzetAll.toLocaleString();
                        
                        const monthlyVals = [];
                        const monthNames = ['Jan','Feb','Mar','Apr','Mei','Jun','Jul','Agu','Sep','Okt','Nov','Des'];
                        monthNames.forEach((m, i) => {
                            let val = parseInt((omzetRow[i+3] || "0").replace(/[^\d]/g, '')) || 0;
                            monthlyVals.push(val);
                            sContainer.innerHTML += `
                                <div class="glass p-6 rounded-3xl border border-purple-500/20 shadow-xl">
                                    <p class="text-[10px] font-black text-gray-500 uppercase mb-2">${m}</p>
                                    <p class="text-purple-400 font-black text-lg">Rp ${val.toLocaleString()}</p>
                                </div>`;
                        });
                        updateChart(monthlyVals);
                    }

                    // 2. PROSES PRODUK (B, C, Q, R)
                    data.forEach((row, i) => {
                        if (i >= 3 && row[1] && row[1].trim() !== "" && row[1].toUpperCase() !== "OMZET") {
                            const nama = row[1]; // Kolom B
                            const hrgModal = parseInt((row[2] || "0").replace(/[^\d]/g, '')) || 0; // Kolom C
                            const terjual = parseInt(row[16]) || 0; // Kolom Q
                            const stok = parseInt(row[17]) || 0; // Kolom R
                            const assetMati = stok * hrgModal;
                            
                            totalModalDead += assetMati;
                            totalCogsSold += (terjual * hrgModal);

                            // Tabel Rincian Keuangan
                            fTable.innerHTML += `
                                <tr class="hover:bg-white/5 transition">
                                    <td class="p-5 font-black uppercase text-white">${nama}</td>
                                    <td class="p-5 text-center text-gray-400 font-bold">Rp ${hrgModal.toLocaleString()}</td>
                                    <td class="p-5 text-center font-black text-amber-500 text-lg">${stok}</td>
                                    <td class="p-5 text-right font-black text-green-500">Rp ${assetMati.toLocaleString()}</td>
                                    <td class="p-5 text-center">
                                        <span class="status-badge ${terjual < 10 ? 'bg-red-500/10 text-red-500 border border-red-500/30' : 'bg-green-500/10 text-green-500 border border-green-500/30'}">
                                            ${terjual < 10 ? 'Obral / Diskon' : 'Produksi Stabil'}
                                        </span>
                                    </td>
                                </tr>`;

                            // Analisa Pasar Cards
                            let trendIcon = terjual > 10 ? 'üî•' : 'üê¢';
                            let statusColor = stok < 10 ? 'border-red-500' : 'border-sky-500';
                            
                            mContainer.innerHTML += `
                                <div class="glass p-6 border-l-[12px] ${statusColor} hover:scale-[1.02] transition">
                                    <div class="flex justify-between items-start mb-4">
                                        <h4 class="font-black uppercase text-sm leading-tight">${nama}</h4>
                                        <span class="text-xl">${trendIcon}</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2 text-[10px] font-bold uppercase mb-4">
                                        <div class="bg-white/5 p-2 rounded">Terjual: <span class="text-white">${terjual}</span></div>
                                        <div class="bg-white/5 p-2 rounded">Stok: <span class="text-white">${stok}</span></div>
                                    </div>
                                    <div class="text-[9px] font-black italic text-center p-2 rounded-xl border border-dashed border-white/20">
                                        ${stok < 10 ? 'üö® SEGERA PRODUKSI ULANG!' : (terjual < 10 ? 'üìâ REKOMENDASI DISKON BESAR' : '‚úÖ TREND PASAR BAGUS')}
                                    </div>
                                </div>`;
                        }
                    });

                    // 3. UPDATE TOTAL AKHIR
                    document.getElementById('mainModalMati').innerText = "Rp " + totalModalDead.toLocaleString();
                    document.getElementById('mainProfit').innerText = "Rp " + (totalOmzetAll - totalCogsSold).toLocaleString();
                }
            });
        }

        let myChart;
        function updateChart(data) {
            const ctx = document.getElementById('chartOmzet').getContext('2d');
            if (myChart) myChart.destroy();
            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Jan','Feb','Mar','Apr','Mei','Jun','Jul','Agu','Sep','Okt','Nov','Des'],
                    datasets: [{
                        data: data,
                        borderColor: '#2ea043',
                        borderWidth: 4,
                        pointBackgroundColor: '#fff',
                        backgroundColor: 'rgba(46, 160, 67, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#8b949e', font: {size: 10} } },
                        x: { grid: { display: false }, ticks: { color: '#8b949e', font: {size: 10} } }
                    }
                }
            });
        }
        syncData();
    </script>
</body>
</html>


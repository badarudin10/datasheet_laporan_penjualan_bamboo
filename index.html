<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Monitoring Penjualan BambooArt</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f0f2f0; }
        .bamboo-bg { background: linear-gradient(135deg, #1e3a1e 0%, #0d1a0d 100%); }
        .card-shadow { box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05); }
        .product-card:hover { transform: translateY(-5px); transition: all 0.3s ease; }
    </style>
</head>
<body class="min-h-screen pb-12">

    <header class="bamboo-bg text-white pt-10 pb-20 px-6 rounded-b-[3rem] shadow-2xl mb-[-4rem]">
        <div class="max-w-6xl mx-auto flex flex-col md:flex-row justify-between items-center text-center md:text-left">
            <div>
                <h1 class="text-3xl font-bold tracking-tight">BambooArt <span class="text-green-400">Dashboard</span></h1>
                <p id="status" class="text-green-300/70 text-sm mt-1 italic italic">üîÑ Menyambungkan data...</p>
            </div>
            <div class="mt-6 md:mt-0 bg-white/10 p-4 rounded-2xl border border-white/10 backdrop-blur-sm text-center">
                <p class="text-[10px] uppercase font-bold opacity-60">Total Omzet Tahunan</p>
                <h2 id="displayRev" class="text-2xl font-black text-white leading-none mt-1">Rp 0</h2>
            </div>
        </div>
    </header>

    <main class="max-w-6xl mx-auto px-6">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-10">
            <div class="bg-white p-6 rounded-3xl card-shadow flex flex-col justify-center">
                <p class="text-gray-400 text-xs font-bold uppercase tracking-wider mb-1">Unit Terjual</p>
                <div class="flex items-baseline gap-2">
                    <h2 id="displaySold" class="text-4xl font-black text-gray-800">0</h2>
                    <span class="text-gray-400 font-bold">Pcs</span>
                </div>
                <div id="soldBar" class="w-full bg-gray-100 h-2 rounded-full mt-4">
                    <div id="soldProgress" class="bg-green-500 h-2 rounded-full" style="width: 0%"></div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-3xl card-shadow border-l-8 border-orange-500">
                <p class="text-gray-400 text-xs font-bold uppercase tracking-wider mb-1">Stok Tersedia</p>
                <h2 id="displayStock" class="text-4xl font-black text-gray-800">0</h2>
                <p id="stockAlert" class="text-[10px] font-bold mt-2 uppercase text-green-600 tracking-tighter italic italic italic italic">Stok Aman</p>
            </div>

            <div class="bg-white p-4 rounded-3xl card-shadow flex items-center justify-center">
                <button onclick="window.print()" class="w-full py-4 bg-stone-800 hover:bg-black text-white rounded-2xl font-bold transition">üñ®Ô∏è Cetak Laporan</button>
            </div>
        </div>

        <div class="bg-white p-8 rounded-[2rem] card-shadow border border-gray-100 mb-10">
            <h3 class="text-gray-800 font-bold text-lg mb-6 border-l-4 border-green-500 pl-4 italic">Tren Penjualan Bulanan</h3>
            <div class="h-64">
                <canvas id="mainChart"></canvas>
            </div>
        </div>

        <div class="mb-10">
            <h3 class="text-gray-800 font-bold text-xl mb-6 text-center italic underline decoration-green-500 decoration-4">Produk Unggulan - Bestseller 2026</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                
                <div class="bg-white rounded-[2rem] overflow-hidden card-shadow product-card border border-gray-100">
                    <img src="https://images.unsplash.com/photo-1544413647-ad6717a26f98?q=80&w=800" class="w-full h-48 object-cover" alt="Kapal Pinisi">
                    <div class="p-6 text-center">
                        <h4 class="font-bold text-gray-800">Kapal Pinisi & Bambu</h4>
                        <p class="text-xs text-gray-400 mt-1 uppercase font-bold tracking-widest">Peringkat 1</p>
                    </div>
                </div>

                <div class="bg-white rounded-[2rem] overflow-hidden card-shadow product-card border border-gray-100">
                    <img src="https://images.unsplash.com/photo-1518780664697-55e3ad937233?q=80&w=800" class="w-full h-48 object-cover" alt="Rumah Tradisional">
                    <div class="p-6 text-center">
                        <h4 class="font-bold text-gray-800">Rumah Tradisional</h4>
                        <p class="text-xs text-gray-400 mt-1 uppercase font-bold tracking-widest">Peringkat 2</p>
                    </div>
                </div>

                <div class="bg-white rounded-[2rem] overflow-hidden card-shadow product-card border border-gray-100">
                    <img src="https://images.unsplash.com/photo-1533473359331-0135ef1b58bf?q=80&w=800" class="w-full h-48 object-cover" alt="Mobil Klasik">
                    <div class="p-6 text-center">
                        <h4 class="font-bold text-gray-800">Mobil Klasik Bambu</h4>
                        <p class="text-xs text-gray-400 mt-1 uppercase font-bold tracking-widest">Peringkat 3</p>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <script>
        const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQXdrHU-IFBl2jmf3Unzy8Jb2Uh7VfK5uvX0OeO7Ivlc88QC6ahXNFJf1VlGWlTb7Mfp4xzeSY6BsXx/pub?output=csv";

        function init() {
            Papa.parse(sheetUrl, {
                download: true,
                header: false,
                skipEmptyLines: true,
                complete: function(results) {
                    const rows = results.data;
                    const totalRow = rows.find(r => r.some(cell => cell && cell.toString().toUpperCase() === 'TOTAL'));
                    if (totalRow) updateDashboard(totalRow);
                }
            });
        }

        function updateDashboard(row) {
            const soldTotal = parseInt(row[18]) || 0;
            const stockTotal = parseInt(row[19]) || 0;
            const revenueTotal = row[20] || "0";

            document.getElementById('displaySold').innerText = soldTotal.toLocaleString('id-ID');
            document.getElementById('displayStock').innerText = stockTotal.toLocaleString('id-ID');
            document.getElementById('displayRev').innerText = "Rp " + revenueTotal;
            document.getElementById('status').innerText = "‚úÖ Data Sinkron Secara Otomatis";

            // Progress Bar & Alert
            const totalInventory = soldTotal + stockTotal;
            const pct = (soldTotal / totalInventory) * 100;
            document.getElementById('soldProgress').style.width = pct + "%";

            const alertEl = document.getElementById('stockAlert');
            if(stockTotal < 500) {
                alertEl.innerText = "üö® Status: Stok Kritis!";
                alertEl.className = "text-[10px] font-bold mt-2 uppercase text-red-600 animate-pulse";
            }

            // Data Bulanan
            const monthlyValues = [];
            for (let i = 4; i <= 15; i++) {
                let val = row[i] ? row[i].toString().replace(/\D/g, '') : "0";
                monthlyValues.push(parseInt(val) || 0);
            }
            renderChart(monthlyValues);
        }

        let myChart;
        function renderChart(data) {
            const ctx = document.getElementById('mainChart').getContext('2d');
            if (myChart) myChart.destroy();
            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Jan','Feb','Mar','Apr','Mei','Jun','Jul','Agu','Sep','Okt','Nov','Des'],
                    datasets: [{
                        label: 'Unit Keluar',
                        data: data,
                        borderColor: '#22c55e',
                        backgroundColor: 'rgba(34, 197, 94, 0.1)',
                        fill: true,
                        tension: 0.4,
                        borderWidth: 4,
                        pointRadius: 6,
                        pointBackgroundColor: '#fff'
                    }]
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } }
                }
            });
        }

        init();
        setInterval(init, 300000); // Sinkron tiap 5 menit
    </script>
</body>
</html>

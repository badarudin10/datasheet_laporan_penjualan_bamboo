<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BambooArt Executive Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #1a2a1f url('https://www.transparenttextures.com/patterns/dark-wood.png'); color: white; }
        .glass-card { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 2rem; }
        .stat-card-green { background: linear-gradient(135deg, #4caf50, #1b5e20); }
        .stat-card-blue { background: linear-gradient(135deg, #2196f3, #0d47a1); }
        .stat-card-orange { background: linear-gradient(135deg, #ff9800, #e65100); }
    </style>
</head>
<body class="p-4 md:p-10">
    <div class="max-w-6xl mx-auto">
        <div class="flex flex-col md:flex-row justify-between items-center mb-10 gap-4">
            <div class="flex items-center gap-4">
                <div class="bg-green-500 p-4 rounded-3xl font-black text-2xl shadow-xl text-white">BA</div>
                <h1 class="text-3xl font-extrabold tracking-tight">BambooArt <span class="text-green-400">Dashboard</span></h1>
            </div>
            <div class="bg-white/5 border border-white/10 px-6 py-2 rounded-full text-[10px] font-bold tracking-widest text-green-400">‚óè LIVE DATA SINKRON</div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-10 text-white">
            <div class="stat-card-green p-10 rounded-[2.5rem] shadow-2xl">
                <p class="text-xs font-bold uppercase opacity-80 mb-2">Total Omzet</p>
                <h2 id="displayRev" class="text-4xl font-black italic text-white">Rp 0</h2>
            </div>
            <div class="stat-card-blue p-10 rounded-[2.5rem] shadow-2xl">
                <p class="text-xs font-bold uppercase opacity-80 mb-2">Unit Terjual</p>
                <h2 id="displaySold" class="text-5xl font-black italic text-white">0</h2>
            </div>
            <div class="stat-card-orange p-10 rounded-[2.5rem] shadow-2xl">
                <p class="text-xs font-bold uppercase opacity-80 mb-2">Sisa Stok</p>
                <h2 id="displayStock" class="text-4xl font-black italic text-white">0</h2>
            </div>
        </div>

        <div class="glass-card p-8 mb-10 h-80">
            <canvas id="lineChart"></canvas>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-10">
            <div class="glass-card overflow-hidden bg-white/5">
                <img src="https://images.unsplash.com/photo-1544413647-ad6717a26f98?w=500" class="h-48 w-full object-cover border-b-2 border-green-500">
                <div class="p-4 text-center font-bold">KAPAL PINISI</div>
            </div>
            <div class="glass-card overflow-hidden bg-white/5">
                <img src="https://images.unsplash.com/photo-1518780664697-55e3ad937233?w=500" class="h-48 w-full object-cover border-b-2 border-green-500">
                <div class="p-4 text-center font-bold">RUMAH TRADISIONAL</div>
            </div>
            <div class="glass-card overflow-hidden bg-white/5">
                <img src="https://images.unsplash.com/photo-1533473359331-0135ef1b58bf?w=500" class="h-48 w-full object-cover border-b-2 border-green-500">
                <div class="p-4 text-center font-bold">MOBIL KLASIK</div>
            </div>
        </div>

        <div class="glass-card overflow-hidden shadow-2xl">
            <div class="p-6 border-b border-white/10 bg-white/5 font-bold text-green-400">INVENTORY DETAIL</div>
            <div class="overflow-x-auto">
                <table class="w-full text-left">
                    <thead class="bg-black/20 text-xs text-green-500 font-black">
                        <tr>
                            <th class="p-6">PRODUK</th>
                            <th class="p-6 text-center">TERJUAL</th>
                            <th class="p-6 text-center text-center">STOK</th>
                            <th class="p-6 text-right">STATUS</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody" class="divide-y divide-white/5"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQXdrHU-IFBl2jmf3Unzy8Jb2Uh7VfK5uvX0OeO7Ivlc88QC6ahXNFJf1VlGWlTb7Mfp4xzeSY6BsXx/pub?output=csv";

        function fetchData() {
            Papa.parse(sheetUrl, {
                download: true,
                complete: function(results) {
                    const data = results.data;
                    const header = data[2]; // Biasanya baris judul ada di baris ke-3 (index 2)
                    
                    // Mencari index kolom secara dinamis
                    const idxSold = header.findIndex(h => h.includes("Unit Keluar") || h.includes("Terjual"));
                    const idxStock = header.findIndex(h => h.includes("Sisa Stok") || h.includes("Stok Akhir"));
                    const idxRev = header.findIndex(h => h.includes("Omzet") || h.includes("Total Harga"));

                    // Update Angka Utama dari Baris TOTAL
                    const totalRow = data.find(r => r.some(cell => cell.toString().toUpperCase().includes("TOTAL")));
                    if (totalRow) {
                        document.getElementById('displaySold').innerText = totalRow[idxSold] || "0";
                        document.getElementById('displayStock').innerText = totalRow[idxStock] || "0";
                        document.getElementById('displayRev').innerText = "Rp " + (totalRow[idxRev] || "0");
                        
                        // Grafik Bulanan (ambil 12 kolom dari index 4 ke depan)
                        const monthlyValues = totalRow.slice(4, 16).map(v => parseInt(v.toString().replace(/\D/g, '')) || 0);
                        renderChart(monthlyValues);
                    }

                    // Isi Tabel
                    const tbody = document.getElementById('tableBody');
                    tbody.innerHTML = '';
                    data.forEach((row, i) => {
                        if (i > 2 && row[2] && !row[2].includes("TOTAL") && row[idxSold]) {
                            const stockVal = parseInt(row[idxStock]) || 0;
                            tbody.innerHTML += `
                                <tr class="hover:bg-white/5 transition">
                                    <td class="p-6 font-bold">${row[2]}</td>
                                    <td class="p-6 text-center font-mono text-blue-400">${row[idxSold]}</td>
                                    <td class="p-6 text-center font-mono">${stockVal}</td>
                                    <td class="p-6 text-right">
                                        <span class="px-3 py-1 rounded-full text-[9px] font-black ${stockVal < 15 ? 'bg-red-500/20 text-red-500' : 'bg-green-500/20 text-green-500'}">
                                            ${stockVal < 15 ? 'RE-STOCK' : 'AMAN'}
                                        </span>
                                    </td>
                                </tr>`;
                        }
                    });
                }
            });
        }

        function renderChart(data) {
            const ctx = document.getElementById('lineChart');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Jan','Feb','Mar','Apr','Mei','Jun','Jul','Agu','Sep','Okt','Nov','Des'],
                    datasets: [{
                        data: data, borderColor: '#4caf50', backgroundColor: 'rgba(76, 175, 80, 0.2)',
                        fill: true, tension: 0.4, borderWidth: 4, pointRadius: 4
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, 
                    scales: { y: { display: false }, x: { ticks: { color: 'rgba(255,255,255,0.5)' }, grid: { display: false } } }
                }
            });
        }

        fetchData();
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biipsite.Art Management System</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #0d1117; color: #e6edf3; }
        .glass-card { background: #161b22; border: 1px solid #30363d; border-radius: 1.5rem; transition: 0.3s; }
        .glass-card:hover { border-color: #238636; box-shadow: 0 10px 30px -10px rgba(35, 134, 54, 0.2); }
        .modal { display: none; position: fixed; inset: 0; background: rgba(1, 4, 9, 0.98); z-index: 1000; padding: 20px; overflow-y: auto; }
        .btn-primary { background: #238636; color: white; padding: 10px 20px; border-radius: 12px; font-weight: 700; font-size: 11px; text-transform: uppercase; transition: 0.2s; }
        .btn-primary:hover { background: #2ea043; transform: scale(1.02); }
        .btn-outline { border: 1px solid #30363d; color: #8b949e; padding: 10px 20px; border-radius: 12px; font-weight: 700; font-size: 11px; text-transform: uppercase; }
        .btn-outline:hover { background: #21262d; color: white; }
        @media print { .no-print { display: none; } }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-6xl mx-auto">
        <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-10 gap-6 no-print">
            <div>
                <h1 class="text-3xl font-extrabold tracking-tighter text-white uppercase italic">Biipsite<span class="text-green-500">.Art</span></h1>
                <p class="text-[10px] font-bold text-gray-500 uppercase tracking-[0.3em]">Operational Dashboard v7.5</p>
            </div>
            <div class="flex flex-wrap gap-2">
                <a href="https://docs.google.com/spreadsheets/d/14ZCE5Vh3yCfBwJqztin6lwNRFfviPGFh7ThLQQMHTi4/edit" target="_blank" class="btn-primary flex items-center gap-2">
                    <span>âž• Input Data Penjualan</span>
                </a>
                <button onclick="syncData()" class="btn-outline">ðŸ”„ Perbarui Data</button>
                <button onclick="window.print()" class="btn-outline">ðŸ“„ Cetak</button>
            </div>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
            <div onclick="openModal('modalFinance')" class="glass-card p-6 cursor-pointer border-b-4 border-b-green-500">
                <p class="text-[10px] font-black text-gray-500 uppercase mb-1">Pendapatan Tahunan</p>
                <h2 id="totalOmzet" class="text-3xl font-black text-white italic">Rp 0</h2>
            </div>
            <div class="glass-card p-6 border-b-4 border-b-sky-500">
                <p class="text-[10px] font-black text-gray-500 uppercase mb-1">Total Unit Terjual</p>
                <h2 id="totalItemKeluar" class="text-3xl font-black text-white italic">0</h2>
            </div>
            <div onclick="openModal('modalStock')" class="glass-card p-6 cursor-pointer border-b-4 border-b-amber-500">
                <p class="text-[10px] font-black text-gray-500 uppercase mb-1">Nilai Inventaris (Sisa)</p>
                <h2 id="totalModalStok" class="text-3xl font-black text-white italic">Rp 0</h2>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <div class="lg:col-span-2 glass-card p-6">
                <h3 class="text-[10px] font-black uppercase text-gray-500 mb-6 text-center italic tracking-widest">Analisa Pertumbuhan Bulanan</h3>
                <div class="h-64"><canvas id="mainChart"></canvas></div>
            </div>
            <div class="glass-card p-6 flex flex-col justify-between">
                <div>
                    <h3 class="text-[10px] font-black uppercase text-gray-500 mb-4">Informasi Sistem</h3>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-gray-400">Status Database</span>
                            <span class="text-[10px] font-black text-green-500 bg-green-500/10 px-2 py-1 rounded">TERHUBUNG</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-gray-400">Sinkron Terakhir</span>
                            <span id="updateTime" class="text-xs font-bold text-white">--:--</span>
                        </div>
                    </div>
                </div>
                <div class="mt-8 p-4 bg-white/5 rounded-2xl text-[9px] text-gray-400 italic leading-relaxed">
                    Sistem Biipsite.Art memproses data secara otomatis dari lembar kerja utama untuk akurasi laporan keuangan.
                </div>
            </div>
        </div>

        <div class="glass-card overflow-hidden">
            <div class="p-6 border-b border-gray-800">
                <h3 class="text-xs font-black uppercase italic">Audit Performa Produk</h3>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-left text-xs">
                    <thead class="bg-gray-800/50 uppercase font-black text-gray-500">
                        <tr>
                            <th class="p-4">Nama Produk</th>
                            <th class="p-4 text-center">Harga Unit</th>
                            <th class="p-4 text-center">Stok Awal</th>
                            <th class="p-4 text-center">Terjual</th>
                            <th class="p-4 text-center">Stok Sisa</th>
                            <th class="p-4 text-right">Subtotal Omzet</th>
                        </tr>
                    </thead>
                    <tbody id="productBody" class="divide-y divide-gray-800"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="modalFinance" class="modal">
        <div class="max-w-4xl mx-auto py-10">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-2xl font-black italic uppercase text-green-500">Rincian Omzet Bulanan</h2>
                <button onclick="closeModal('modalFinance')" class="text-3xl text-gray-500">&times;</button>
            </div>
            <div id="monthlyGrid" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
        </div>
    </div>

    <div id="modalStock" class="modal">
        <div class="max-w-2xl mx-auto py-10">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-2xl font-black italic uppercase text-amber-500">Audit Sisa Stok</h2>
                <button onclick="closeModal('modalStock')" class="text-3xl text-gray-500">&times;</button>
            </div>
            <div class="glass-card overflow-hidden">
                <table class="w-full text-left text-xs">
                    <thead class="bg-amber-600 text-black font-black uppercase">
                        <tr><th class="p-4">Produk</th><th class="p-4 text-center">Sisa Stok</th><th class="p-4 text-right">Nilai Aset</th></tr>
                    </thead>
                    <tbody id="stockAuditBody" class="divide-y divide-gray-800"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQXdrHU-IFBl2jmf3Unzy8Jb2Uh7VfK5uvX0OeO7Ivlc88QC6ahXNFJf1VlGWlTb7Mfp4xzeSY6BsXx/pub?output=csv";
        let chartInstance;

        function openModal(id) { document.getElementById(id).style.display = 'block'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }

        function syncData() {
            Papa.parse(CSV_URL, {
                download: true,
                complete: function(results) { processData(results.data); }
            });
        }

        function processData(data) {
            const productBody = document.getElementById('productBody');
            const monthlyGrid = document.getElementById('monthlyGrid');
            const stockAuditBody = document.getElementById('stockAuditBody');
            
            productBody.innerHTML = ''; monthlyGrid.innerHTML = ''; stockAuditBody.innerHTML = '';

            let grandTotalT21 = 0;
            let totalUnitKeluar = 0;
            let totalNilaiStok = 0;
            let monthlyValues = Array(12).fill(0);
            const mNames = ['Jan','Feb','Mar','Apr','Mei','Jun','Jul','Agu','Sep','Okt','Nov','Des'];

            data.forEach((row, i) => {
                if (i >= 2 && i < 20) {
                    const nama = row[2]; // C
                    const harga = parseInt((row[3] || "0").replace(/[^\d]/g, '')) || 0; // D
                    const sAwal = row[4]; // E
                    const sKeluar = parseInt(row[17]) || 0; // R
                    const sAkhir = parseInt(row[18]) || 0; // S
                    const subOmzet = parseInt((row[19] || "0").replace(/[^\d]/g, '')) || 0; // T

                    totalUnitKeluar += sKeluar;
                    totalNilaiStok += (sAkhir * harga);

                    productBody.innerHTML += `
                        <tr class="hover:bg-white/5 transition border-b border-gray-800/50">
                            <td class="p-4 font-bold uppercase text-white">${nama}</td>
                            <td class="p-4 text-center text-gray-400 italic">Rp ${harga.toLocaleString()}</td>
                            <td class="p-4 text-center font-bold">${sAwal}</td>
                            <td class="p-4 text-center font-bold text-green-500">${sKeluar}</td>
                            <td class="p-4 text-center font-bold text-amber-500">${sAkhir}</td>
                            <td class="p-4 text-right font-black text-white">Rp ${subOmzet.toLocaleString()}</td>
                        </tr>`;

                    stockAuditBody.innerHTML += `
                        <tr class="border-b border-gray-800">
                            <td class="p-4 font-bold uppercase">${nama}</td>
                            <td class="p-4 text-center font-black text-amber-500">${sAkhir}</td>
                            <td class="p-4 text-right font-black">Rp ${(sAkhir * harga).toLocaleString()}</td>
                        </tr>`;

                    for (let m = 0; m < 12; m++) {
                        let qty = parseInt(row[5 + m]) || 0;
                        monthlyValues[m] += (qty * harga);
                    }
                }

                if (i === 20) {
                    grandTotalT21 = parseInt((row[19] || "0").replace(/[^\d]/g, '')) || 0;
                }
            });

            document.getElementById('totalOmzet').innerText = "Rp " + grandTotalT21.toLocaleString();
            document.getElementById('totalItemKeluar').innerText = totalUnitKeluar.toLocaleString();
            document.getElementById('totalModalStok').innerText = "Rp " + totalNilaiStok.toLocaleString();
            document.getElementById('updateTime').innerText = new Date().toLocaleTimeString();

            monthlyValues.forEach((val, idx) => {
                monthlyGrid.innerHTML += `
                    <div class="glass-card p-4 text-center border-l-4 border-green-600">
                        <p class="text-[9px] font-black text-gray-500 uppercase mb-1">${mNames[idx]}</p>
                        <p class="text-sm font-bold text-white">Rp ${val.toLocaleString()}</p>
                    </div>`;
            });

            renderChart(monthlyValues);
        }

        function renderChart(data) {
            const ctx = document.getElementById('mainChart').getContext('2d');
            if (chartInstance) chartInstance.destroy();
            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Jan','Feb','Mar','Apr','Mei','Jun','Jul','Agu','Sep','Okt','Nov','Des'],
                    datasets: [{
                        data: data,
                        borderColor: '#238636',
                        borderWidth: 3,
                        pointBackgroundColor: '#238636',
                        tension: 0.4,
                        fill: true,
                        backgroundColor: 'rgba(35, 134, 54, 0.05)'
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { display: false },
                        x: { ticks: { color: '#8b949e', font: { size: 10 } }, grid: { display: false } }
                    }
                }
            });
        }

        syncData();
    </script>
</body>
</html>
